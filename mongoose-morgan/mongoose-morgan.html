<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Logging Node.js Express HTTP Requests in a MongoDB Database Using
        Mongoose-Morgan npm package</title>

    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <link rel="stylesheet" type="text/css" href="./../index.css">
</head>

<body>
    <div class="container main-container has-sidebar">
        <div class="info-container">
            <!--#region Intro text-->
            <p>Hi &#128075; I'm Nemanja, a software engineer. I work as an Account Manager and Development Team Lead @
                <a href="https://atomia.com" style="text-decoration: underline;">Atomia.</a></p>
            <p>I'm a minimalist and a Chinese food lover. In my spare time you can see me scrolling down the
                9gag memes
                &#128076; or find me running &#127939; outside.</p>
            <!--#endregion-->
            <br /><br />
            <!--#region Social media-->
            <a href="https://github.com/nemanjapetrovic">
                <svg class="social-icons" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="-91 49.217 56.693 56.693"
                    enable-background="new -91 49.217 56.693 56.693" width="56.693px" height="56.693px"
                    xml:space="preserve">
                    <g>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M-62.2607,54.1551c-13.6897,0-24.7909,11.0987-24.7909,24.7909
		c0,10.9532,7.1033,20.2458,16.9536,23.524c1.2388,0.2293,1.6938-0.538,1.6938-1.1927c0-0.5909-0.0229-2.5441-0.0337-4.6156
		c-6.8968,1.4998-8.3521-2.925-8.3521-2.925c-1.1277-2.8653-2.7526-3.6274-2.7526-3.6274c-2.2495-1.5387,0.1695-1.507,0.1695-1.507
		c2.4892,0.1748,3.8002,2.555,3.8002,2.555c2.211,3.7897,5.7995,2.6941,7.2143,2.0606c0.2225-1.6021,0.8648-2.6961,1.574-3.3151
		c-5.5065-0.6266-11.2952-2.7526-11.2952-12.2517c0-2.7065,0.9686-4.9181,2.5546-6.6542c-0.2574-0.6246-1.1061-3.1459,0.2402-6.5609
		c0,0,2.0819-0.6659,6.819,2.5415c1.9777-0.5494,4.0985-0.8248,6.2052-0.8345c2.1068,0.0097,4.2292,0.2851,6.2105,0.8345
		c4.7319-3.2075,6.8106-2.5415,6.8106-2.5415c1.3494,3.4149,0.5007,5.9362,0.2434,6.5609c1.5896,1.7361,2.5513,3.9477,2.5513,6.6542
		c0,9.522-5.7995,11.6183-11.32,12.2321c0.8892,0.7694,1.6814,2.278,1.6814,4.5908c0,3.3171-0.0285,5.9867-0.0285,6.8034
		c0,0.6599,0.4462,1.4329,1.7026,1.1895c9.8451-3.2818,16.9395-12.5712,16.9395-23.5208
		C-37.4698,65.2538-48.5693,54.1551-62.2607,54.1551z" />
                        <path fill="#231F20" d="M-77.6619,89.7492c-0.0545,0.1235-0.2486,0.1603-0.4249,0.0757c-0.18-0.081-0.2806-0.2489-0.2225-0.3724
		c0.0533-0.1267,0.2473-0.1619,0.4269-0.0774C-77.7024,89.4561-77.5997,89.6257-77.6619,89.7492L-77.6619,89.7492z M-77.967,89.5231
		" />
                        <path fill="#231F20"
                            d="M-76.6576,90.8693c-0.1183,0.1094-0.3496,0.0585-0.5063-0.1147c-0.1624-0.1728-0.1924-0.4041-0.0726-0.5152
		c0.1219-0.1095,0.346-0.0581,0.5084,0.1147C-76.5658,90.529-76.5341,90.7583-76.6576,90.8693L-76.6576,90.8693z M-76.8942,90.6155" />
                        <path fill="#231F20" d="M-75.6802,92.2969c-0.152,0.1058-0.4005,0.0068-0.5541-0.2137c-0.152-0.2205-0.152-0.4851,0.0036-0.5909
		c0.1536-0.1058,0.3985-0.0104,0.5541,0.2081C-75.5251,91.9245-75.5251,92.1891-75.6802,92.2969L-75.6802,92.2969z
		 M-75.6802,92.2969" />
                        <path fill="#231F20"
                            d="M-74.3412,93.6765c-0.1359,0.1499-0.4254,0.1094-0.6371-0.095c-0.2169-0.1996-0.277-0.4835-0.1411-0.6334
		c0.1379-0.15,0.429-0.1078,0.6422,0.095C-74.2618,93.2427-74.1965,93.5281-74.3412,93.6765L-74.3412,93.6765z M-74.3412,93.6765" />
                        <path fill="#231F20" d="M-72.4938,94.4775c-0.0601,0.1941-0.3388,0.2822-0.6194,0.1997c-0.2806-0.085-0.4639-0.3123-0.4073-0.5084
		c0.0581-0.1957,0.3384-0.2875,0.621-0.1993C-72.6193,94.0541-72.4357,94.2798-72.4938,94.4775L-72.4938,94.4775z M-72.4938,94.4775
		" />
                        <path fill="#231F20"
                            d="M-70.4648,94.6258c0.0068,0.2044-0.2313,0.374-0.526,0.3776c-0.2963,0.0068-0.5364-0.1588-0.5396-0.36
		c0-0.2065,0.2329-0.374,0.5292-0.3792C-70.7066,94.2586-70.4648,94.4229-70.4648,94.6258L-70.4648,94.6258z M-70.4648,94.6258" />
                        <path fill="#231F20"
                            d="M-68.577,94.3047c0.0353,0.1993-0.1696,0.4041-0.4623,0.4586c-0.2879,0.0529-0.554-0.0705-0.5909-0.2682
		c-0.0357-0.2044,0.1728-0.4093,0.4602-0.4623C-68.8768,93.9819-68.6142,94.1018-68.577,94.3047L-68.577,94.3047z M-68.577,94.3047" />
                    </g>
                </svg>
            </a>
            <a href="https://twitter.com/nem_pet">
                <svg class="social-icons" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="56.693px" height="56.693px"
                    viewBox="0 0 56.693 56.693" enable-background="new 0 0 56.693 56.693" xml:space="preserve">
                    <path d="M28.348,5.157c-13.6,0-24.625,11.027-24.625,24.625c0,13.6,11.025,24.623,24.625,24.623c13.6,0,24.623-11.023,24.623-24.623
	C52.971,16.184,41.947,5.157,28.348,5.157z M40.752,24.817c0.013,0.266,0.018,0.533,0.018,0.803c0,8.201-6.242,17.656-17.656,17.656
	c-3.504,0-6.767-1.027-9.513-2.787c0.486,0.057,0.979,0.086,1.48,0.086c2.908,0,5.584-0.992,7.707-2.656
	c-2.715-0.051-5.006-1.846-5.796-4.311c0.378,0.074,0.767,0.111,1.167,0.111c0.566,0,1.114-0.074,1.635-0.217
	c-2.84-0.57-4.979-3.08-4.979-6.084c0-0.027,0-0.053,0.001-0.08c0.836,0.465,1.793,0.744,2.811,0.777
	c-1.666-1.115-2.761-3.012-2.761-5.166c0-1.137,0.306-2.204,0.84-3.12c3.061,3.754,7.634,6.225,12.792,6.483
	c-0.106-0.453-0.161-0.928-0.161-1.414c0-3.426,2.778-6.205,6.206-6.205c1.785,0,3.397,0.754,4.529,1.959
	c1.414-0.277,2.742-0.795,3.941-1.506c-0.465,1.45-1.448,2.666-2.73,3.433c1.257-0.15,2.453-0.484,3.565-0.977
	C43.018,22.849,41.965,23.942,40.752,24.817z" />
                </svg>
            </a>
            <a href="https://rs.linkedin.com/in/nempet">
                <svg class="social-icons" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="56.693px" height="56.693px"
                    viewBox="0 0 56.693 56.693" enable-background="new 0 0 56.693 56.693" xml:space="preserve">
                    <g>
                        <path
                            d="M28.347,5.155c-13.6,0-24.625,11.025-24.625,24.625c0,13.602,11.025,24.625,24.625,24.625
		c13.598,0,24.623-11.023,24.623-24.625C52.97,16.181,41.944,5.155,28.347,5.155z M42.062,41.741c0,1.096-0.91,1.982-2.031,1.982
		H16.613c-1.123,0-2.031-0.887-2.031-1.982V18.052c0-1.094,0.908-1.982,2.031-1.982H40.03c1.121,0,2.031,0.889,2.031,1.982V41.741z" />
                        <path d="M33.099,26.441c-2.201,0-3.188,1.209-3.74,2.061v0.041h-0.027c0.01-0.012,0.02-0.027,0.027-0.041v-1.768h-4.15
		c0.055,1.17,0,12.484,0,12.484h4.15v-6.973c0-0.375,0.027-0.744,0.137-1.012c0.301-0.744,0.984-1.52,2.129-1.52
		c1.504,0,2.104,1.146,2.104,2.824v6.68h4.15V32.06C37.878,28.224,35.829,26.441,33.099,26.441z" />
                        <path d="M20.864,20.712c-1.419,0-2.349,0.934-2.349,2.159c0,1.197,0.9,2.158,2.294,2.158h0.027c1.447,0,2.348-0.961,2.348-2.158
		C23.157,21.646,22.284,20.712,20.864,20.712z" />
                        <rect x="18.762" y="26.734" width="4.151" height="12.484" />
                    </g>
                </svg>
            </a>
            <a href="https://medium.com/@nempet">
                <svg class="social-icons" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="56.6934px" height="56.6934px"
                    viewBox="0 0 56.6934 56.6934" style="enable-background:new 0 0 56.6934 56.6934;"
                    xml:space="preserve">
                    <path
                        d="M28.6253,4.165c-13.5996,0-24.625,11.0234-24.625,24.623c0,13.5997,11.0254,24.625,24.625,24.625
	c13.5986,0,24.624-11.0253,24.624-24.625C53.2493,15.1883,42.2239,4.165,28.6253,4.165z M23.0709,40.5321
	c0,0.0171-0.0009,0.0322-0.0024,0.0446c-0.0118-0.0038-0.0256-0.0104-0.0412-0.018l-8.5216-4.2608
	c-0.1193-0.0597-0.2505-0.2719-0.2505-0.4055l0.0005-19.5355l8.8152,4.4077V40.5321z M24.1465,31.2272v-8.8948l7.9069,12.8477
	L24.1465,31.2272z M27.6718,26.0087l6.0596-9.8042l8.8934,4.4465l-9.1255,14.8285L27.6718,26.0087z M42.8517,40.5256
	c0,0.017-0.001,0.0322-0.0024,0.0445c-0.0118-0.0047-0.0256-0.0104-0.0407-0.018l-8.5401-4.2693l8.5832-13.9485V40.5256z" />
                </svg>
            </a>
            <!--#endregion-->
            <br /><br /><br />
            <!--#region Copyright -->
            <p class="small-text">&copy; <script>
                    new Date().getFullYear() > 2010 && document.write(new Date().getFullYear());
                </script> Nemanja Petrovic</p>
            <!--#endregion-->
            <br /><br /><br />
        </div>
        <div class="post-container">
            <h1>Logging Node.js Express HTTP Requests in a MongoDB Database Using
                Mongoose-Morgan npm package</h1>
            <p class="post-content-separator">---</p>
            <p>Recently, I have started using Node.js with Express for all of my personal projects. As we all know,
                creating a software without any logging is a bad idea so I had to log data from morgan which is an HTTP
                request logger middleware for express to the database. I found some packages to do this kind of stuff
                but none of them suitable for me so I created my own.</p>
            <p>The package is named <b>mongoose-morgan</b>, here is a <a class="link"
                    href="https://www.npmjs.com/package/mongoose-morgan">link</a>.</p>
            <p><b>mongoose-morgan</b> is an express middleware which combines mongoose and morgan packages by adding an
                additional functionality to log morgan data into MongoDB.</p>
            <h2>Features</h2>
            <p>mongoose-morgan uses <a class="link" href="https://github.com/expressjs/morgan#options">options</a> and
                <a class="link" href="https://github.com/expressjs/morgan#predefined-formats">formatting</a> features
                from
                morgan
                package. In order to find out what options and formatting features are make sure to check morgan <a
                    class="link" href="https://github.com/expressjs/morgan">GitHub page</a>.</p>
            <p>To save data in MongoDB I used mongoose package as one of the most commonly used.</p>
            <h2>Usage</h2>
            <p>To install it just call:</p>
            <pre><code>npm install mongoose-morgan</code></pre>
            <h2>Basic usage example</h2>
            <p>Let's create a basic example of express app</p>
            <pre><code>// express
var express = require('express');
var app = express();

// mongoose-morgan
var mongooseMorgan = require('mongoose-morgan');

// connection-data
var port = process.env.port || 8080;

// Logger
app.use(mongooseMorgan({
    connectionString: 'mongodb://localhost:27017/logs-db'
}));

// run
app.listen(port);
console.log('works... ' + port);</code></pre>
            <p>In this example, we are providing only basic arguments to a mongoose-morgan package. The only requirement
                is to add a connection string to Mongo database. mongoose-morgan will use basic options and features for
                morgan logging.</p>
            <p>It will create a Mongo collection named <b>logs</b> in a logs-db database and a type of
                formatting for morgan data will be <b>combined</b>.</p>
            <h2>Detailed usage</h2>
            <p>The mongoose-morgan is accepting three parameters:<p>
                    <ul>
                        <li>mongoData: object type</li>
                        <li>options: object type - <a class="link"
                                href="https://github.com/expressjs/morgan#options">standard morgan options</a></li>
                        <li>format: string type - <a class="link"
                                href="https://github.com/expressjs/morgan#predefined-formats">standard morgan format</a>
                        </li>
                    </ul>
                    <p>An example without morgan options:</p>
                    <pre><code>app.use(mongooseMorgan({
    connectionString: 'mongodb://localhost:27017/logs-db'
   }, {}, 'short'
));</code></pre>
                    <p>As you can see inside logs-db database this code will create collection named <b>logs</b> and a
                        type of formatting for morgan will be <b>short</b>.</p>
                    <p>Full example:</p>
                    <pre><code>app.use(mongooseMorgan({
        collection: 'error_logger',
        connectionString: 'mongodb://localhost:27017/logs-db',
        user: 'admin',
        pass: 'test12345'
    },
    {
        skip: function (req, res) {
            return res.statusCode < 400;
        }
    },
        'dev'
));</code></pre>
                    <p>In this detailed example, we define MongoDB collection name, username, and password. For morgan
                        options, we defined a function which will filter response status codes and if the status code is
                        lower than 400 it won't save the request in the database. As for the type of formatting, we are
                        using <b>dev</b> format.</p>
                    <p class="post-content-separator">---</p>
                    <p>If you are using morgan package for logging requests in a console you can easily setup your
                        project
                        to log all requests with filtering in a Mongo database by using mongoose-morgan package.</p>
                    <p>The source code of this library can be found inside the <a class="link"
                            href="https://github.com/nemanjapetrovic/mongoose-morgan">GitHub repository</a>. All
                        contributions are very welcome.</p>
                    <p>In the end, I tried to make this library helpful and give something back to the open-source
                        community. If you have thoughts on this you can find me on <a class="link"
                            href="https://twitter.com/nem_pet">Twitter</a> and <a class="link"
                            href="https://www.linkedin.com/in/nempet/">LinkedIn</a>.</p>
        </div>
    </div>
</body>

</html>