<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="canonical" href="https://nempet.com/mongoose-morgan/mongoose-morgan.html" />
    <meta charset="utf-8">
    <title>Logging Node.js Express HTTP Requests in a MongoDB Database Using
        Mongoose-Morgan npm package</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- GitHub icon: https://icons8.com/icon/106567/github -->
    <!-- Twitter icon: https://icons8.com/icon/3861/twitter -->
    <!-- LinkedIn icon: https://icons8.com/icon/3869/linkedin -->
    <!-- Medium icon: https://icons8.com/icons/set/m -->

    <link rel="stylesheet" type="text/css" href="./../index.css">
</head>

<body>
    <div id="topbar"></div>
    <div class="container main-container">
        <div class="post-container">
            <h1 class="post-title">Logging Node.js Express HTTP Requests in a MongoDB Database Using
                Mongoose-Morgan npm package</h1>
            <p class="post-content-separator">---</p>
            <p>Recently, I have started using Node.js with Express for all of my personal projects. As we all know,
                creating a software without any logging is a bad idea so I had to log data from morgan which is an HTTP
                request logger middleware for express to the database. I found some packages to do this kind of stuff
                but none of them suitable for me so I created my own.</p>
            <p>The package is named <b>mongoose-morgan</b>, here is a <a class="link"
                    href="https://www.npmjs.com/package/mongoose-morgan">link</a>.</p>
            <p><b>mongoose-morgan</b> is an express middleware which combines mongoose and morgan packages by adding an
                additional functionality to log morgan data into MongoDB.</p>
            <h2>Features</h2>
            <p>mongoose-morgan uses <a class="link" href="https://github.com/expressjs/morgan#options">options</a> and
                <a class="link" href="https://github.com/expressjs/morgan#predefined-formats">formatting</a> features
                from
                morgan
                package. In order to find out what options and formatting features are make sure to check morgan <a
                    class="link" href="https://github.com/expressjs/morgan">GitHub page</a>.</p>
            <p>To save data in MongoDB I used mongoose package as one of the most commonly used.</p>
            <h2>Usage</h2>
            <p>To install it just call:</p>
            <pre><code>npm install mongoose-morgan</code></pre>
            <h2>Basic usage example</h2>
            <p>Let's create a basic example of express app</p>
            <pre><code>// express
var express = require('express');
var app = express();

// mongoose-morgan
var mongooseMorgan = require('mongoose-morgan');

// connection-data
var port = process.env.port || 8080;

// Logger
app.use(mongooseMorgan({
    connectionString: 'mongodb://localhost:27017/logs-db'
}));

// run
app.listen(port);
console.log('works... ' + port);</code></pre>
            <p>In this example, we are providing only basic arguments to a mongoose-morgan package. The only requirement
                is to add a connection string to Mongo database. mongoose-morgan will use basic options and features for
                morgan logging.</p>
            <p>It will create a Mongo collection named <b>logs</b> in a logs-db database and a type of
                formatting for morgan data will be <b>combined</b>.</p>
            <h2>Detailed usage</h2>
            <p>The mongoose-morgan is accepting three parameters:
            <p>
            <ul>
                <li>mongoData: object type</li>
                <li>options: object type - <a class="link" href="https://github.com/expressjs/morgan#options">standard
                        morgan options</a></li>
                <li>format: string type - <a class="link"
                        href="https://github.com/expressjs/morgan#predefined-formats">standard morgan format</a>
                </li>
            </ul>
            <p>An example without morgan options:</p>
            <pre><code>app.use(mongooseMorgan({
    connectionString: 'mongodb://localhost:27017/logs-db'
   }, {}, 'short'
));</code></pre>
            <p>As you can see inside logs-db database this code will create collection named <b>logs</b> and a
                type of formatting for morgan will be <b>short</b>.</p>
            <p>Full example:</p>
            <pre><code>app.use(mongooseMorgan({
        collection: 'error_logger',
        connectionString: 'mongodb://localhost:27017/logs-db',
        user: 'admin',
        pass: 'test12345'
    },
    {
        skip: function (req, res) {
            return res.statusCode < 400;
        }
    },
        'dev'
));</code></pre>
            <p>In this detailed example, we define MongoDB collection name, username, and password. For morgan
                options, we defined a function which will filter response status codes and if the status code is
                lower than 400 it won't save the request in the database. As for the type of formatting, we are
                using <b>dev</b> format.</p>
            <p class="post-content-separator">---</p>
            <p>If you are using morgan package for logging requests in a console you can easily setup your
                project
                to log all requests with filtering in a Mongo database by using mongoose-morgan package.</p>
            <p>The source code of this library can be found inside the <a class="link"
                    href="https://github.com/nemanjapetrovic/mongoose-morgan">GitHub repository</a>. All
                contributions are very welcome.</p>
            <p>In the end, I tried to make this library helpful and give something back to the open-source
                community. If you have thoughts on this you can find me on <a class="link"
                    href="https://twitter.com/nem_pet">Twitter</a> and <a class="link"
                    href="https://www.linkedin.com/in/nempet/">LinkedIn</a>.</p>
        </div>
    </div>
</body>

</html>